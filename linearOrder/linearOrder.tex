\chapter{Infinity and Linear Ordering}\label{chapter:LinearOrder}
The next theorem on the agenda is Theorem~6, and in this chapter, we will look at two different ways to deal with it formally. The theorem itself tells us that any finite set of points on a line are linearly ordered in terms of betweenness. One approach to formalising this is at the metalevel, where it can be treated as an algorithm for enumerating cases of betweenness. In another approach, we can formalise the theorem at the object level and verify it. In so doing, we shall derive the Axiom of Infinity. All the development up to now has been independent of this axiom, which we manually removed from HOL~Light as explained in \S\ref{sec:NoInfinity}.

\section{Theorem 6 at the Metalevel}\label{sec:Theorem6}
We ended the last chapter by discussing two parts to Hilbert's proof of Theorem~5. The final part of this proof can be generalised to formalise and verify Theorem~6.

\begin{quote}THEOREM 6 (generalization of Theorem~5). Given any finite number of points on a line it is always possible to label them $A$, $B$, $C$, $D, \ldots, K$ in such a way that the point labelled $B$ lies between $A$, and $C$,$D$,$E, \ldots, K$, the point labelled $C$ lies between $A$, $B$ and $D$,$E,\ldots K,$ $D$ lies between $A$,$B$,$C$ and $E, \ldots,$ etc. Besides this order of labelling there is only the reverse one that has the same property.
\end{quote}

A \emph{labelling} of a point is, of course, a syntactic device, \emph{used} to \emph{mention} points. As with many logicians of the time, Hilbert was likely away of the distinction between \emph{use} and \emph{mention}, even though he was working before it had been formalised.

Thinking in terms of formal languages, we could identify a \emph{labelling} as the assignment of an existing value to a new variable. The existence of a labelling is then the existence of these assignments. With this in mind, we could semi-formalise Theorem~6 to say that, given some points on a line $A'$, $B'$, $C'$, $D'$, $\ldots$, $K'$, there exists an appropriate assignment to $A$, $B$, $C$, $D$, $\ldots$, $K$:
\begin{equation}
  \begin{split}
    &\exists a. \code{on\_line}\ A'\ a\wedge\code{on\_line}\ B'\ a\wedge\code{on\_line}\ C'\ a\wedge\code{on\_line}\ D'\ a\\
    &\qquad\wedge\code{on\_line}\ E'\ a\wedge\cdots\wedge\code{on\_line}\ K'\ a\\
    &\implies\exists A\ B\ C\ D\ \ldots\ K. \\
    &\qquad\qquad A = A' \wedge B = B' \wedge C = C' \wedge D = D' \wedge E = E' \wedge \cdots \wedge K = K'\\
    &\qquad\quad\wedge\left(\between{A}{B}{C} \wedge \between{A}{B}{D} \wedge \between{A}{B}{E} \wedge \cdots \wedge \between{A}{B}{K}\right) \\
    &\qquad\quad\wedge
    \left(\begin{split}&\between{A}{C}{D} \wedge \between{A}{C}{E} \wedge \cdots \wedge \between{A}{C}{K}\\
        &\wedge\between{B}{C}{D} \wedge \between{B}{C}{E} \wedge \between{B}{C}{K}\\
        &\qquad\wedge \cdots \wedge \between{B}{C}{K}
      \end{split}\right)\\  
    &\qquad\quad\wedge
    \left(\begin{split}&\between{A}{D}{E} \wedge \cdots \wedge \between{A}{D}{K} \\
        &\wedge\between{B}{D}{E} \wedge \cdots \wedge \between{B}{D}{K} \\
        &\wedge\between{C}{D}{E} \wedge \cdots \wedge \between{B}{D}{K}
        \end{split}\right)\\
    &\qquad\quad\wedge\code{between}\ldots.
  \end{split}
\end{equation} 

Obviously, we cannot capture this directly in first-order logic. The fact that we quantify over an unspecified number of variables already renders that goal hopeless. Instead, the use of ellipses here tells us that this is a \emph{scheme}. As we fix our choice of variables in $A, B, C, D, E, \ldots, K$, we are expected to fill in the holes by continuing a syntactic pattern.

In short, this is a metatheorem, something perhaps surprisingly typical of mathematics. As noted by Harrison~\cite{FormalizedMathematics}, the existence of such theorems must be borne in mind when formalising, and he mentions the simple example of an object theorem about certain operations being associative and commutative (say, addition), which entails the \emph{metatheorem} that brackets (bits of syntax) can be dropped without ambiguity.

Hilbert was working before any distinction had been made between metalevel and object level, let alone the sort of hard distinction we now have between HOL and the programming metalanguage (ML) which encodes its syntax and inference rules. With such a distinction, we immediately realise that our schematic above can be formalised as an ML function which inputs a list of points, fills in the scheme to create a true HOL term, and then derives it as a theorem.

\subsection{Representation}
Consider applying Theorem~6 to the special case of Theorem~5 where there are only four points $A'$, $B'$, $C'$, $D'$ and four labels $A$, $B$, $C$ and $D$. The theorem we must generate is then:

\begin{equation}
  \begin{split}
    &\exists a. \code{on\_line}\ A\ a\wedge\code{on\_line}\ B\ a\wedge\code{on\_line}\ C\ a\wedge\code{on\_line}\ D\ a\\
    &\implies\exists A\ B\ C\ D.\ A = A' \wedge B = B' \wedge C = C' \wedge D = D'\\
    &\qquad\quad\wedge\between{A}{B}{C} \wedge \between{A}{B}{D}\\
    &\qquad\quad\wedge\between{B}{C}{D}
  \end{split}
\end{equation} 

Now we can unwind this existential into the disjunction given in Figure~\ref{fig:Theorem5CasesFormalised}, and thus this sufficies as a formalisation of Theorem~5. It is rather verbose though, and as we increase the number of points, the number of disjuncts will explode. 

Hilbert does not state Theorem~6 with any efficiency in mind, as he lists all possible betweenness relations among the points considered. We shall not be so wasteful, and will control this blow-up by finding a concise, canonical representation of the linear order of points on a line. The constraint is that we should be able to quickly derive any member of the full set of betweenness relations from the canonical representation.

\begin{figure}
  \begin{align*}
    &\fourbet{A}{B}{C}{D}\\
    &\vee\fourbet{B}{A}{C}{D}\\
    &\vee\fourbet{B}{C}{A}{D}\\
    &\vee\fourbet{A}{D}{C}{B}\\
    &\vee\fourbet{A}{C}{B}{D}\\
    &\vee\fourbet{C}{A}{B}{D}\\
    &\vee\fourbet{C}{B}{A}{D}\\
    &\vee\fourbet{A}{D}{B}{C}\\
    &\vee\fourbet{A}{B}{D}{C}\\
    &\vee\fourbet{B}{A}{D}{C}\\
    &\vee\fourbet{B}{D}{A}{C}\\
    &\vee\fourbet{B}{D}{C}{A}
  \end{align*}
\caption{Theorem~5 Case Split}
\label{fig:Theorem5CasesFormalised}
\end{figure}

Typically, a geometry will have a specified origin and a specified axis on which to define the preferred orientation. Even coordinate free methods such as the signed-area method~\cite{SignedAreaMethod} specify a preferred orientation. Not so in Hilbert's geometry. But we \emph{can} treat the first argument to the between predicate as a parameter giving the preferred origin and direction, and then regard the partially applied relation as a two place binary order. In other words, we can read $\between{A}{B}{C}$ as saying that $B<C$ from the perspective of origin $A$ and direction $\overrightarrow{AB}$.

We can then represent total orders as conjunctions ordering adjacent points. So, if $A,B,C,D,E,F,G,H$ occur along a line in that order, we just need the six conjuncts
\begin{multline}\label{theorem:OrderRepExample}
\between{A}{B}{C} \wedge \between{A}{C}{D} \wedge \between{A}{D}{E}\\
\wedge\between{A}{E}{F}\wedge\between{A}{F}{G}\wedge\between{A}{G}{H}.
\end{multline}

We want to retrieve all other between relations implied by this term quickly. Before we describe how we do this, we will interpret Theorem~5, whose verification we considered in the last chapter, as two separate rules. The first rule \eqref{eq:five2a} will ``move the origin'' in a total order. The second rule \eqref{eq:five2b} is just transitivity if we think of the between relation as a parameterised binary relation.
\begin{gather}
\label{eq:five2a}\between{A}{B}{C} \wedge \between{A}{C}{D} \implies \between{B}{C}{D}\\
\label{eq:five2b}\between{A}{B}{C} \wedge \between{A}{C}{D} \implies \between{A}{B}{D}
\end{gather}

We now explain our strategy by way of example. Suppose our goal is to derive $\between{C}{F}{H}$ from \eqref{theorem:OrderRepExample}. Our first task is to ``move the origin'' from $C$ to $A$. To do so, we match against \eqref{eq:five2a}, to yield:
\begin{displaymath}
\between{A}{C}{F} \wedge \between{A}{F}{H}.
\end{displaymath}

We now just reason transitively from the conjuncts of the ordering. We split \eqref{theorem:OrderRepExample} into the two suborderings either side of $F$
\begin{displaymath}
\between{A}{C}{D} \wedge \between{A}{D}{E} \wedge\between{A}{E}{F}
\end{displaymath}
and
\begin{displaymath}
\between{A}{F}{G}\wedge\between{A}{G}{H}.
\end{displaymath}

and then obtain $\between{A}{C}{F}$ and $\between{A}{F}{H}$ by folding Rule~\eqref{eq:five2b} across their conjuncts:
\begin{align*}
\between{A}{C}{D} &\wedge \between{A}{D}{E} \wedge\between{A}{E}{F}\\
&\longrightarrow \between{A}{C}{E} \wedge \between{A}{E}{F}\\
&\longrightarrow \between{A}{C}{F}
\end{align*}
and
\begin{align*}
\between{A}{F}{G} &\wedge \between{A}{G}{H}\\
&\longrightarrow \between{A}{F}{H}.
\end{align*}

We have implemented this procedure as a completely deterministic tactic, taking a theorem such as \eqref{theorem:OrderRepExample} and a term such as $\between{C}{F}{H}$, and then deriving the term from the order in one pass of the order conjunction.

\subsection{Enumerating Possible Orderings}
Even with the more concise representation of orderings, there are $\frac{1}{2}n!$ orderings to consider for $n$ points. In practice, when we want to apply the theorem, there are usually additional constraints on the ordering that allow us to eliminate most of the cases by appealing to Axiom~II,3. For instance, if we know that $\between{B}{A}{C}$ and $\between{B}{D}{C}$, then there are only two ways to order $A$, $B$, $C$ and $D$:
\begin{align*}
&\fourbet{B}{A}{D}{C}\\
&\vee\fourbet{B}{D}{A}{C}
\end{align*}

Factoring in these constraints not only cuts down the size of the final conclusion, but significantly speeds up the calculation of the possibilities. Thus, the procedure we have defined to enumerate all possible orderings takes both a list of the points we want it to order, and a list of betweeness constraints on those points. 

This algorithm nicely captures the purpose of a metatheorem such as Hilbert's if we see it as a computation on labellings. It also keeps us well within the scope of first-order logic. However, our ML algorithm is only a verification of the particular instances it generates. The algorithm, the metatheorem itself, is unverified. To verify it, we must bring the metalevel down to the object level.

\section{Theorem~6 at the Object Level}
Any logic which can formalise Theorem~6 will need to include a domain of labellings, which is potentially infinite. One such domain appears in Dehlinger et al's verification~\cite{DehlingerFOG} in the form of lists. Our formalisation is equivalent. We treat a labelling as an assignment from an initial prefix of natural numbers to the points being labelled. Formally:
\label{sec:OrderingDef}
\begin{equation}\label{eq:OrderingDef}
  \begin{split}
    \code{ordering}\ f\ X &\iff X = f\left(\left\{n\ \vert\ \code{finite}\ X \implies n < \left|X\right|\right\}\right)\\
    &\wedge \forall n\ n'\ n''. \code{finite}\ X \implies n < \left|X\right| \wedge n' < \left|X\right| \wedge n'' < \left|X\right|\\
    &\qquad\wedge n < n' \wedge n' < n'' \wedge \between{(f\ n)}{(f\ n')}{(f\ n'')}.
    \end{split}
\end{equation}

Our definition here allows for the possibility that $f$ is an ordering of a (countably) infinite set $X$. In this infinite case, we just drop the constraint that $n$, $n'$ and $n''$ are bounded by its finite cardinality.\footnote{In HOL~Light, the \code{finite} sets are defined to be the empty set, and all adjoins to all finite sets.}

Theorem~6 can then be formalised concisely as:
\begin{equation}
\label{eq:Infinity}
  \code{finite}\ X \wedge\code{collinear}\ X \implies \exists f. \code{ordering}\ f\ X.
\end{equation}

% In the recursive case, we must order $n+1$ points by ordering sets of $n$ points. Suppose the \mbox{$n+1$} points are $P_1$, $P_2$, $\ldots$, $P_n$, $P_{n + 1}$. We first invoke the function recursively to order $P_1$, $P_2$, $\ldots$, $P_{n}$. For each ordering $r$ returned, we invoke the function recursively again to order $P_1$, $P_3$, $\ldots$, $P_{n+1}$ (the totality of points with the exception of $P_2$) subject to the constraints implied by $r$. This gives $r$ possibilities, one for each placement of $P_{n+1}$ relative to $P_1$, $P_2$, $\ldots$, $P_n$ (see Figure \ref{fig:PointOrdering})

% \begin{figure}
%   % \begin{pspicture}(-1,0)(5,3)
%   %   \put(1.2,0.6){\parbox{5cm}{\scriptsize$P_1$}}
%   %   \put(3.8,0.6){\parbox{5cm}{\scriptsize$P_2$}}
%   %   \put(5.0,0.6){\parbox{5cm}{\scriptsize$P_3$}}
%   %   \put(7.0,0.6){\parbox{5cm}{\scriptsize$P_{n-1}$}}
%   %   \put(8.2,0.6){\parbox{5cm}{\scriptsize$P_n$}}

%   %   \put(0.5,1.5){\parbox{5cm}{\scriptsize$P_{n+1}$}}
%   %   \put(3.8,1.5){\parbox{5cm}{\scriptsize$P_{n+1}$}}
%   %   \put(6.0,1.5){\parbox{5cm}{\scriptsize$P_{n+1}$}}
%   %   \put(7.5,1.5){\parbox{5cm}{\scriptsize$P_{n+1}$}}
%   %   \put(9.0,1.5){\parbox{5cm}{\scriptsize$P_{n+1}$}}

%   %   \psdot(1.4,1,0)
%   %   \psdot(4.0,1,0)
%   %   \psdot(5.2,1,0)
%   %   \psdot(7.2,1,0)
%   %   \psdot(8.2,1,0)

%   %   \psline[linestyle=dashed](0.75,1.0)(0.75,1.4)
%   %   \psline[linestyle=dashed](3.8,1.0)(4.0,1.4)
%   %   \psline[linestyle=dashed](4.2,1.0)(4.0,1.4)
%   %   \psline[linestyle=dashed](6.25,1.0)(6.25,1.4)
%   %   \psline[linestyle=dashed](7.75,1.0)(7.75,1.4)
%   %   \psline[linestyle=dashed](9.25,1.0)(9.25,1.4)

%   %   \psline[linewidth=0.25mm](0.0,1.0)(9.5,1.0)
%   % \end{pspicture}
% \caption{Ordered points}
% \label{fig:PointOrdering}
% \end{figure}

% The final case-split is required to deal with the case:

% \begin{displaymath}
% \between{P_1}{P_2}{P_3}\,\wedge\,\between{P_1}{P_3}{P_4}\,\wedge\,\cdots\,\between{P_1}{P_{n-1}}{P_n}
% \end{displaymath}
% and
% \begin{displaymath}
% \between{P_1}{P_{n+1}}{P_3}\,\wedge\,\between{P_1}{P_3}{P_4}\,\wedge\,\cdots\,\between{P_1}{P_{n-1}}{P_n}
% \end{displaymath}

% This means we know that $P_2$ and $P_{n+1}$ both lie between $P_1$ and $P_3$, but we cannot say which comes first. We need to use Theorem~4 on $P_1$, $P_2$ and $P_{n+1}$, from which we have one of $\between{P_1}{P_2}{P_{n+1}}$, $\between{P_2}{P_1}{P_{n+1}}$ and $\between{P_1}{P_{n+1}}{P_2}$. The second of these is contradictory, leaving only the two outer cases and the two possible orderings
% \begin{displaymath}
% \between{P_1}{P_2}{P_{n+1}} \,\wedge\,\between{P_1}{P_{n+1}}{P_3}\,\wedge\,\cdots\,\between{P_1}{P_{n-1}}{P_n}
% \end{displaymath}
% and
% \begin{displaymath}
% \between{P_1}{P_{n+1}}{P_2}\,\wedge\,\between{P_1}{P_2}{P_3}\,\wedge\,\cdots\,\between{P_1}{P_{n-1}}{P_n}
% \end{displaymath}

% respectively. The result is now a disjunction of total orders of the original $n+1$ points.

% Now if we think of Theorem~6 as a metatheorem, then we can implement it in our theorem prover's metalanguage, as a procedure which takes a given list of points and then produces all possible orderings of those points. A list of possible orderings can be expressed using an existential theorem. Thus, if we take the finite set of points to be labelled as $S$, we can write
% \begin{align*}\label{theorem:Theorem6Example}
% \exists A\,B\,C&\,D\,\ldots\,I\,J\,K \in S.\tag{$\ddagger$}\\
%                 &\between{A}{B}{C} \wedge \between{A}{C}{D} \wedge \cdots \wedge \between{I}{J}{K}.                 
% \end{align*}

% But note that we are only working with finitely many points, so we can unfold this existential into a disjunction, against which we can immediately perform case-splits without having to reason about properties of finite sets. 

\section{Natural Numbers}
Our definition assumes the existence of natural numbers, but Hilbert, writing before the investigations of the logicists, was not clear whether he took these to be logically primitive. Veblen, writing some years later, is explicit: ``[The axioms] presuppose only the validity of the operations of logic and of counting (ordinal number)''. Hilbert \emph{seems} to be making the assumption implicitly when he states the Archimedean Axiom in his Group~V, though it could be argued that the following is only meant schematically:
\begin{quote}
  If $AB$ and $CD$ are any segments then there exists a \textbf{number} $n$ such that $n$ segments $CD$ constructed contiguously from $A$, along the ray from $A$ through $B$, will pass beyond the point $B$.
[emphasis added]\end{quote}

Euclid does much the same when he expresses the same property using the word ``multiplied'' (though Euclid mistakes this property for a \emph{definition}):
\begin{quote}
  Magnitudes are said to have a ratio to one another which can, when multiplied, exceed one another.\cite{Aleph0Elements}
\end{quote}

Yet elsewhere, Euclid will discuss natural numbers in geometrical terms: his books on number theory literally identify numbers with line segments. Hilbert is faithful to this idea. He shows how to recover arithmetic operations from geometrical figures by exploiting Pascal's and Desargues' Theorems. So why would they want to assume the existence of natural numbers?

The question of foundations here, whether natural numbers are a primitive logical concept required of the theory, or whether they are to be recovered geometrically, is difficult to answer. So when it comes to formalisation, we have tried to base our decisions on the broad philosophical and historical aims of the text. Pasch, Peano, Hilbert and Veblen are all supposed to be rigorising the synthetic geometry of Euclid's \emph{Elements}. There is a story that Euclid, following on from the first crisis in the foundations of mathematics and the discovery of incommensurable magnitudes, would have regarded natural numbers with suspicion, and thus kept them out of his logical foundation~\cite{EvolutionEuclideanElements}. Instead, numbers were to be grounded on secure geometrical notions.

\subsection{The Axiom of Infinity}
The theorem stating that natural numbers exist is derivable in HOL~Light assuming a domain exists which is Dedekind-infinite.
\begin{equation}\label{eq:InfinityAxiom}
  \exists f : ind\rightarrow ind. \code{one\_one}\ f \wedge \neg\code{onto}\ f.
\end{equation}

This theorem asserts that there is a one-one but not onto function $f$. From it, we can nominate an arbitrary member of the set $\{ i : ind\ \vert\ \neg\exists i'. f\ i' = i \}$ to serve as the number $0$, nominate $f$ as the successor function, and carve out the natural numbers as the smallest set containing $0$ and its own image under $f$.

The existence of the infinite domain $ind$ is not generally assumed as part of classical logic proper, and Russell, in his classic \emph{Principia Mathematica}, took it as a mere hypothesis on the theorems which required it~\cite{LogicismRevisited}. Without the axiom, one must allow for the possibility that our domains --- the sets of set theory and the types of simple type theory --- each has only finitely many inhabitants.

This should not be the case for the primitive domains of Hilbert's geometry. Hilbert insists as much for his Theorem~7, which states quite plainly that ``between any two points on a line there exists an infinite number of points.'' Thus, we should be able to derive Theorem~\ref{eq:InfinityAxiom} from Hilbert's geometric axioms. We can then obtain the natural numbers from this theorem, replacing the abstract type $ind$ with a concrete type of geometric objects. Our natural numbers will then be quite literally founded in geometry.

This can be dealt with nicely in HOL~Light. The axioms of infinity, choice and extensionality are not part of the HOL~Light kernel. Instead, they are asserted with \code{new\_axiom}, exactly as we have asserted the axioms of geometry. Thus, to replace the axiom of infinity, we just will not load its theory file. Instead of asserting the axiom, we load the theory files containing our geometric axioms, and \emph{derive it}. 

After this, we can reload the usual HOL~Light theories which depend on the axiom of infinity, thus reproducing the whole of the HOL~Light standard library from a geometric foundation.

\subsection{Models and a Finite Interpretation}
The fact that Hilbert's domains are infinite is not derivable from Group~I. We can prove this by exhibiting a finite model of the Group~I axioms. To do so formally, we define a two-place predicate \code{Group\_I} over arbitrary relations $l$ and $p$. By instantiating the polymorphic types of these relations, one supplies the domains of the interpretation. We then assert a particular model of the axioms by writing, for appropriate $l$ and $p$:
\begin{displaymath}
\code{Group\_I}\ l\ p
\end{displaymath}

Incidentally, we have used the same predicate to assert the Group~I axioms. Having declared our primitive types and our primitive relations, we write
\begin{displaymath}
  \code{new\_axiom}\ (\code{Group\_I}\ \code{on\_line}\ \code{on\_plane}).
\end{displaymath}

Besides allowing us to do this, the predicate $\code{Group\_I}$ allows us to express basic metatheoretical ideas about the Group~I axioms, and if we treat the hypothesis as a \emph{context} of axioms, we can regard it as a basic mechanism to write a module of incidence proofs. 

In general, such techniques have significant weaknesses. For one, we are limited in how much we can reason about theories of polymorphic values. We would want to be able to do this if we wanted to reason about the theory of monads in Chapter~\ref{chapter:Automation}. This would require a stronger type-theory, such as the extension provided by HOL~Omega~\cite{HOLOmega}.

For another, when we want to treat $\code{Group\_I}\ \code{on\_line}\ \code{on\_plane}$ as a module of theorems, we would still have no convenient way to make new definitions or abstract out new types. This would require a more sophisticated embedding such as the one underlying Isabelle's locales~\cite{IsabelleLocales}.

These issues are not a problem for the specific purposes of this chapter, where we only have to consider a very simple metatheoretical question, but it could cause problems reasoning in later groups such as Group~III where axioms are defined based on quite complex and derived definitions.

A finite model of Group~I, then, is realised in the four vertices, six lines, and four planes of a tetrahedron. In this finite interpretation, we can translate all our first-order axioms into propositional theorems and verify them with a tautology checker.

To capture this idea formally, we carved out two finite types. One type is inhabited by four constructors which can be used as interpretations of the four points and the four planes in our model. The other type is inhabited by six constructors, which become our six lines.
\begin{align*}
\code{ps}   &= \code{p1} \vert \code{p2} \vert\code{p3} \vert\code{p4}\\
\code{lines}&= \code{l1} \vert \code{l2} \vert\code{l3} \vert\code{l4} \vert\code{l5} \vert\code{l6}\\
\end{align*}

The type definitions are used to automatically derive an abstract type and derive two theorems, an induction theorem and a recursion theorem. For the type \code{ps}, for instance, we are given
\begin{align*}
&\forall P.\ P\ \code{p1}\ \wedge\ P\ \code{p2}\ \wedge\ P\ \code{p3}\ \wedge\ P\ \code{p4}\implies\forall p. P\ p\\
&\forall p1\ p2\ p3\ p4.\ \exists f.\ f\ \code{p1} = p1\ \wedge\ f\ \code{p2} = p2\ \wedge\ f\ \code{p3} = p3\ \wedge\ f\ \code{p4} = p4.
\end{align*}

The first (induction) theorem can be promoted to an equivalence, and then used to rewrite all universally quantified statements as finite conjunctions. Similarly, its rewrite using the infinite DeMorgan rule, $(\forall x. P\,x) \iff \neg\exists x. \neg (P\,x)$ can be used to rewrite all existentially quantified statements as finite disjunctions.

Next, by instantiating the universally quantified variables in the second (recursion) theorem with the first four natural numbers respectively, we can prove that \code{p1}, \code{p2}, \code{p3} and \code{p4} are mutually distinct. From this, every valid first-order formula over the types \code{ps} and \code{lines} can be rewritten to a mere tautology and then quickly verified.

To check our model, we first inductively defined the incidence predicates \code{on\_line} and \code{on\_plane} over the types \code{ps} and \code{lines}, as shown in Figure~\ref{fig:SmallestModel}. We then formalised the following theorem in HOL~Light 
\begin{displaymath}
\code{Group1}\ \code{online}\ \code{onplane}.
\end{displaymath}

\begin{figure}
\begin{minipage}[c]{4cm}
\begin{align*}
& \online{\code{p1}}\code{l1}\wedge \online{\code{p2}}\code{l1}\\
\wedge & \online{\code{p1}}\code{l2}\wedge \online{\code{p3}}\code{l2}\\
\wedge & \online{\code{p2}}\code{l3}\wedge \online{\code{p3}}\code{l3}\\
\wedge & \online{\code{p1}}\code{l4}\wedge \online{\code{p4}}\code{l4}\\
\wedge & \online{\code{p2}}\code{l5}\wedge \online{\code{p4}}\code{l5}\\
\wedge & \online{\code{p3}}\code{l6}\wedge \online{\code{p4}}\code{l6}\\
\\
& \onplane{\code{p1}}{\code{p1}}\wedge \onplane{\code{p2}}{\code{p1}}\wedge \onplane{\code{p3}}{\code{p1}}\\
\wedge & \onplane{\code{p1}}{\code{p2}}\wedge \onplane{\code{p2}}{\code{p2}}\wedge \onplane{\code{p4}}{\code{p2}}\\
\wedge & \onplane{\code{p1}}{\code{p3}}\wedge \onplane{\code{p3}}{\code{p3}}\wedge \onplane{\code{p4}}{\code{p3}}\\
\wedge & \onplane{\code{p2}}{\code{p4}}\wedge \onplane{\code{p3}}{\code{p4}}\wedge \onplane{\code{p4}}{\code{p1}}
\end{align*}\end{minipage}\centering\includegraphics[scale=0.8]{linearOrder/Tetra}
\caption{Smallest model}\label{fig:SmallestModel}
\end{figure}

After unfolding the definitions of $\code{on\_line}$ and $\code{on\_plane}$, it turns out that the theorem can be proven by equational reasoning alone. We replace the universals and existentials with conjunctions and disjunctions respectively. After simplifying, the remaining goals require us to show that points, lines or planes are distinct, which is dealt with by the recursion theorem.

The same method allows us to formally deal with the case of a weakened Axiom~\ref{eq:g13a} that we mentioned briefly in \S\ref{sec:DanglingPoints}. We just define a seven element finite set for the lines, and use the same inductive definitions for \code{on\_line} and \code{on\_plane}, leaving the seventh line ``dangling'' without any incident points. Again, by rewriting the axioms propositionally and simplifying, we can show that this is a (presumably inappropriate) model for the weakened axioms, and thus justify our formalisation of Axiom~\ref{eq:g13a}.

To show that the tetrahedron model is minimal, we verified that there exist four points, six lines and four planes satisfying the conditions we gave to inductively define \code{on\_line} and \code{on\_plane} in the model. We know from Theorem~\ref{eq:PlaneThree} that there are three distinct points on a plane. From axiom \code{g18}, there is a fourth point not on this plane. The remaining axioms are then sufficient to connect each pair of points by a unique line.

\section{Infinity}\label{sec:Infinity}
Our axioms now only have infinite models. Indeed, it would seem immediately that we can apply Axiom~\ref{eq:g22} indefinitely to obtain an arbitrary number of points. Starting from distinct points $A$ and $B$, we can obtain points $A$, $B$, $C$, $D$, $E$, $\ldots$, $Y$, $Z$, satisfying 

\begin{align*}
&\between{A}{B}{C}\\
&\between{A}{C}{D}\\
&\between{A}{D}{E}\\
&\ldots\\
&\between{A}{Y}{Z}
\end{align*}

With Theorem~5, we can move from theorems such as $\between{A}{B}{C}$ and $\between{A}{C}{D}$ to $\between{A}{B}{D}$, and so can prove that the points above are mutually distinct. This process therefore gives us a potentially infinite number of points.

\section{A Geometric Successor}
The function which is said to exist in the theorem of infinity is a successor function. It is possible to  witness this theorem, and, staying faithful to Hilbert's prose, we will use a witness that is effectively a function between any two points of a line segment. The witness is based on the diagram in Figure~\ref{fig:successor}.

\begin{figure}
\centering\includegraphics[scale=0.5]{linearOrder/InfinitySteps}
\caption{The successor function}
\label{fig:successor}
\end{figure}

\begin{figure}
\centering\includegraphics[scale=0.5]{linearOrder/InfinityFull}
\caption{Successors tending to $A$}
\label{fig:FullSuccessor}
\end{figure}

Formally, the diagrams are the sets of points satisfying the following constraint

\begin{align}
&\Triangle{a}{A}{B}{0} \label{theorem:IndConstraint}\\
&\qquad\wedge \between{A}{D}{B} \wedge \between{B}{0}{C}\notag\\
&\qquad\wedge (\between{A}{N}{0} \vee N = 0)\notag
\end{align}

Our natural numbers are carved out from the set of all diagrams satisying this property. We abstract this set into a type ($\code{ind}$), giving us two functions: a constructor $\code{mk\_ind}$ which promotes any diagram into the abstract type, and a destructor $\code{dest\_ind}$ which converts an inhabitant of the abstract type into its diagram representation. In order for this to be sound, we only need to prove that the type will have at least one inhabitant. This is easily settled, since the diagram for $0$ is constructed in the proof of Theorem~3 (\S\ref{sec:Theorem3}). 

Each diagram is represented by six points, five of which are fixed by the successor function, while the sixth point $N$ starts at $0$ and moves step-by-step towards $A$. The points $C_1$, $C_2$ and $C_3$, shown in Figure~\ref{fig:successor}, are not explicitly represented in our type but can be determined as the intersection of $BN$ and $CD$.

Informally, and for the purposes of explaining our formalisation, we will identify diagrams up to the equality of the five fixed points. We can then determine a diagram from the sixth point. In this way, when we talk of the object $0$, we may be referring to the \emph{diagram} 0, which is the six-tuple representing inhabitants of $\code{ind}$, or to the \emph{point} 0, which is the sixth component of this six-tuple. Similarly, we shall talk about the \emph{diagram} that is the successor of 0, as well as the \emph{point} that is the successor of 0. This is just for convenience here. The formalisation itself is always unambiguous.

Thus, the successor of $0$ is the diagram obtained by replacing $0$ with $1$, the intersection of $CD$ and $A0$. To obtain the next successor, we first find the intersection of $1D$ and $AC$, namely the point $C_1$. We then replace $1$ with the intersection of $C_1D$ and $A0$. 

In general, the successor of a diagram is obtained by finding $C'$, the intersection of $DN$ and $AC$, and then finding the intersection of $C'D$ and $A0$. Formally:

\begin{align*}
\code{ind\_suc}\, n =& \code{let } (A,B,C,D,0,N) = \code{dest\_ind}\ n \code{ in}\\
&\quad \code{mk\_ind} (A,B,C,D,0,\iota S.\\
&\quad\qquad \exists C'. (\exists a. \online{B}{a} \wedge \online{C'}{a} \wedge \online{N}{a})\\
&\qquad\qquad \wedge (\exists a. \online{C'}{a} \wedge \online{D}{a} \wedge \online{S}{a})\\
&\qquad\qquad \wedge (\exists a. \online{A}{a} \wedge \online{C}{a} \wedge \online{C'}{a})\\
&\qquad\qquad \wedge \between{A}{S}{0} \wedge \between{A}{S}{N})
\end{align*}

We have used the $\iota$ operator in this definition. This is the ``definite description'' operator, which is a weaker version of the $\epsilon$ indefinite description operator. The $\epsilon$ operator is one of the three classical axioms of higher-order logic, and equivalent to the full axiom of choice.
\begin{displaymath}
\forall P\ x. P\ x \implies P (\epsilon x. P x)
\end{displaymath}

From $\epsilon$, we can define the $\iota$ operator, which requires that the predicate $P$ is satisfied by exactly one value. 
\begin{displaymath}
  \iota x. P\ x = \epsilon x. P\ x \wedge \forall y. P\ y \implies x = y
\end{displaymath}

By using this operator and avoiding the somewhat controversial axiom of choice, we feel we are in a better position to argue that we have recovered the axiom of infinity in a logically ``secure'' way. The images of our successor function are uniquely defined from their predecessors, and the natural numbers themselves can be uniquely carved out of the type $\code{ind}$. There is exactly one object $0$ up to relabellings of the points in our figures, not an arbitrary set of possibilities in an abstract type from which we choose one example.

The price comes in the complexity of the $\code{ind}$ representatives. We cannot simply define an infinite domain of points. We need enough information in each of our figures to constrain the possible placement of successors relative to their predecessors.

\subsection{Lemmas}
Our successor function deconstructs an abstract diagram into its six points. It then chooses the unique point $S$, and finally rebuilds the diagram. 

We now need some lemmas concerning $\code{dest\_ind}$. Importantly, we need to show that the reconstructed diagram represents an abstract diagram, and thus show that the image of $\code{mk\_ind}$ in our definition is non-arbitrary. Formally:
\begin{align*}
\code{dest\_ind}\ (\code{ind\_suc}\ n) = & \code{let } (A,B,C,D,0,N) = \code{dest\_ind} n \code{ in}\\
&\quad (A,B,C,D,0,\iota S.\\
&\quad\quad \exists C'. (\exists a. \online{B}{a} \wedge \online{C'}{a} \wedge \online{N}{a})\\
&\qquad\quad \wedge (\exists a. \online{C'}{a} \wedge \online{D}{a} \wedge \online{S}{a})\\
&\qquad\quad \wedge (\exists a. \online{A}{a} \wedge \online{C'}{a} \wedge \online{D}{a})\\
&\qquad\quad \wedge \between{A}{S}{0} \wedge \between{A}{S}{N})
\end{align*} 

The key step needed to verify this theorem comes from realising that the diagrams involving the points $A,B,C,0,D$ and $A,B,C',N,D$ satisfy the same constraints. In each case, we apply Pasch's axiom \eqref{eq:g24} to $\triangle AB0$ and the line $CD$ to obtain a point $S$ between $A$ and $0$. For our initial diagram, we can apply this argument directly. For the other diagrams, we just need to find the point $C'$.

To do this, we apply Pasch's axiom \eqref{eq:g24} to $\triangle A0C$ and the line $DN$, to place the point $C'$ between $A$ and $C$. We can now use the previous argument to locate $S$ between $A$ and $N$. Finally, since $N$ is between $A$ and $0$, \ref{eq:five} shows that the point $S$ must also lie between $A$ and $0$. 

\section{Theorem of Infinity}
Finally, we must verify that our function is one-one but not onto. To verify that $\code{ind\_suc}$ is one-one, we went procedurally, but with the assistance of our discoverers via \code{discover\_tac by\_eqs}. This used incidence reasoning to automatically find equalities that arise from our diagrams. 

We verified the fact that \code{ind\_suc} is not onto declaratively. The basic verification works by noting that $0$ defines the first diagram, while all images of $\code{ind\_suc}$ use a point $S$ which is defined to be strictly between $A$ and $0$. Thus, $0$ is not in the image of the function.
\begin{equation}
\tag{\ref{eq:Infinity}}
\code{one\_one}\ \code{ind\_suc} \wedge \neg\code{onto}\ \code{ind\_suc}.
\end{equation}

This now shows that the abstract type $\code{ind}$ has an infinite domain. However, the domain is not the natural numbers. Since we are allowed to take the successor in any diagram where the point $N$ is any point lying between $A$ and $0$, or is the point $0$ itself, it is clear that most of the images of $\code{ind\_suc}$ are \emph{not} in the sequence
\begin{displaymath}
0, \code{ind\_suc } 0, \code{ind\_suc }(\code{ind\_suc } 0), \code{ind\_suc }(\code{ind\_suc }(\code{ind\_suc } 0)),  \ldots.
\end{displaymath}
For instance, no point between $0$ and $\code{ind\_suc}\ 0$ is in this sequence.

To remove the unwanted diagrams, we follow HOL~Light's construction of the natural numbers, which inductively restricts us to the smallest closure of the successor function starting from $0$. 

% \section{Infinity with Linear Reasoning}
% We now return to the more intuitive argument for an infinite set given at the beginning of \S\ref{sec:Infinity}. This argument shows that there must be an infinite number of points on a line, since we can start with any line segment and extend it indefinitely. We can prove this quite neatly. We first find a suitable type, and prove that it is inhabited.

% \begin{align*}
% \exists (A,X,B). A \neq B \wedge \forall P. P \in X \rightarrow \between{A}{P}{B}.
% \end{align*}

% Thus, we are defining an abstract type represented by triples. The first and last component of each triple are the end-points of a line segment. The second component is some subset of the points in between the end-points (our chosen example are two of the points given by Axiom~I,3 together with the empty set).

% The successor function deconstructs the abstract type, and then maps the resulting triple $(A,X,B)$ to $(A,X \cup \{B\}, C)$ where $C$ is an arbitrarily chosen point extending the segment $AB$ as per Axiom~II,2. We are only required to show that the new segment $AC$ bounds all the points in $X \cup \{B\}$, a matter which is guaranteed by Theorem~5.

% Proving that this function is not onto is again simple. The triple whose second component is the empty set cannot possibly be in the image of the successor function, since the successor function always produces a non-empty set in the second component.

% To prove that the function is one-one, we must show the following:

% \begin{displaymath}
% (A,X \cup \{B\}, \epsilon C. \between{A}{B}{C}) = (A,X' \cup \{B'\}, \epsilon C. \between{A}{B'}{C}).
% \end{displaymath}

% Well, if $B\neq B'$, it would follow that $B\in X'$ while $B'\in X$. Therefore, $\between{A}{B}{B'}$ and $\between{A}{B'}{B}$ which contradicts Axiom~II,3. Thus, \mbox{$B = B'$}, and so $X = X'$ and since the third components now choose from the same predicate, the third components are also equal.

% This gives us another proof of the theorem of infinity, using only our linear axioms and the linear Theorem~5. However, it suffers from the fact that it relies on the axiom of choice to pick out an \emph{arbitrary} extension to every line segment, while the previous proof of the theorem used only uniquely definable points.

\section{Theorem~6 Revisited}
Now that we have two ways to carve out the natural numbers from geometric objects, we can return to our verification of \S\ref{sec:Theorem6}. Recall our definition of an \emph{ordering} from \S\ref{sec:OrderingDef}:
\begin{equation}
  \tag{\ref{eq:OrderingDef}}
  \begin{split}
    \code{ordering}\ f\ X &\iff X = f\left(\left\{n\ \vert\ \code{finite}\ X \implies n < \left|X\right|\right\}\right)\\
    &\wedge \forall n\ n'\ n''. \code{finite}\ X \implies n < \left|X\right| \wedge n' < \left|X\right| \wedge n'' < \left|X\right|\\
    &\qquad\wedge n < n' \wedge n' < n'' \wedge \between{(f\ n)}{(f\ n')}{(f\ n'')}.
    \end{split}
\end{equation}

There is a lot of symmetry in this definition. Firstly, we have
\begin{displaymath}
\between{(f\ n)}{(f\ n')}{(f\ n'')} \iff \between{(f\ n'')}{(f\ n')}{(f\ n)}
\end{displaymath}
since we can always permute the first and last arguments of the \code{between} predicate. Secondly, given three distinct points $n$, $n'$ and $n''$, there are six ways to arrange them so that they are linearly ordered.

In some cases, we can take care of this latter symmetry by following a simple technique~\cite{HarrisonWLOG} in proving a suitable  without-loss-of-generality theorem. Informally, our theorem says that if a formula is true regardless of how one arranges the free-variables, then we can assume a specific ordering on those variables. Formally, for the case of three variables:
\begin{displaymath}
  \begin{split}
    &(\forall m\ n. P\ m\ m\ n)\\
    &\wedge \left(\forall m\ n\ p. P\ m\ n\ p \iff P\ n\ m\ p\right)\\
    &\wedge \left(\forall m\ n\ p. P\ m\ n\ p \iff P\ n\ p\ m\right)\\
    &\wedge (\forall m\ n\ p. m < n \wedge n < p \implies P\ m\ n\ p)\\
    &\implies \forall m\ n\ p. P\ m\ n\ p.
  \end{split}
\end{displaymath}

The second and third conditions require that the predicate $P$ holds up to any symmetry in its arguments. With these, the first condition requires that the predicate is true assuming that any two of its arguments are equal. Thus, in the fourth condition, we can assume that the the first argument is strictly less than the second which is strictly less than the third, and from this conclude that the predicate holds for any three natural numbers (which, we recall, are concretely represented by a sequence of geometric figures). 

In practice, the idea to using this theorem is to match its conclusion to the goal, discharge the first three conditions using simplification, and then attempt to prove the remaining ``without loss of generality'' condition.

%Another useful definition we shall give is for the \emph{bounds} or extremities of a set of points:

%In order to make this definition useful, we need to supply a set of lemmas and theorems that are sufficiently rich that we rarely need to unfold the definitions. Figure~\ref{fig:OrderLemmas}\footnote{The term $\text{INJ}\,f\,X$ says that $f$ is injective on the set $X$} shows the main formalisations.

% \begin{figure}
% \begin{align}
% &\forall P\,X. \bounds{P}{P}{X} \iff X = \{P\}\\
% &\forall P\,Q\,X. \bounds{P}{Q}{X} \iff \bounds{Q}{P}{X}\\
% &\forall A\,B\,P\,Q\,X. \bounds{A}{B}{X} \wedge \bounds{P}{Q}{X} \implies A = P \vee A = Q\\
% &\forall P\,Q\,X. \bounds{P}{Q}{X} \implies \forall A\,B. A \in X \wedge B \in X \implies \neg\between{A}{P}{X}\\
% &\forall P\,Q\,R\,X. \bounds{P}{Q}{X} \wedge (\forall A\,B. A \in X \wedge B \in X \wedge \neg\between{A}{R}{B})\notag\\
% &\qquad\implies R = P \vee R = Q\\
% &\forall P\,Q\,R. \code{collinear} \{P,Q,R\} \implies \exists f. ORDERING f \{P,Q,R\}\\
% &\forall f\,X. \code{ordering}{f}{X} \implies \text{INJ}\,f\,\{ n \vert FINITE X \implies n < |X| \}\\
% &\forall f\,X. \code{FINITE} X \label{eq:OrderRev}\\
% &\quad\implies (\code{ordering}{f}{X} \iff \code{ordering} (\lambda n. f\,(|X| - n - 1)) X)\\
% &\forall f\,X\,x. x \in X \wedge \code{FINITE} X \wedge \code{ordering}{f}{X}\label{eq:OrderBounds}\\
% &\quad\implies \bounds{(f 0)}{(f (CARD X - 1))}{X}\\
% &\forall f\,x\,X. \code{FINITE} X \wedge \code{ordering}{f}{X} \wedge \between{(f 0)}{(f (|X| - 1))}{x}\notag\\
% &\qquad \implies \exists g. \code{ordering}{g}{(\{x\} \cup X)}\label{eq:OrderExtend}\\
% &\forall f\,P\,Q\,X\,x. x \in X \wedge \code{FINITE} X \wedge \code{ordering}{f}{X} \wedge \bounds{P}{Q}{X}\notag\\
% &\qquad\implies\exists f'. \code{ordering}{f'}{X} \wedge f'\,0 = P \wedge f'\,(CARD X - 1) = Q\label{eq:ChooseOrder}\\
% &\forall f\,X. \code{ordering}{f}{X} \implies \code{collinear} X
% \end{align}
% \caption{Order Lemmas}
% \label{fig:OrderLemmas}
% \end{figure}

\subsection{Verification}
% \begin{displaymath}\label{eq:BoundDef}
% \bounds{P}{Q}{X} \iff P \in X \wedge Q \in X \wedge \forall R. R\in (X - \{P,Q\}) \implies \between{P}{R}{Q}.
% \end{displaymath}
In verifying \ref{eq:six}, we have tried to reinforce Hilbert's claim that it is a generalisation of Theorem~5 by showing how to generalise his \emph{proof}. Up until now, we have not even considered the special case of the proof, which makes up the third and final part of the proof of Theorem~5. This is given in Figure~\ref{fig:Theorem5Cases}

\begin{figure}
\framebox{\begin{minipage}{\linewidth}Now let any four points on a line be given. Take three of the points and label $Q$ the one which by Theorem~4 and Axiom~II,3 lies between the other two and label the other two $P$ and $R$. Finally, label $S$ the last of the four points. By Axiom~II,3 and Theorem~4 again it follows then that the following five distinct possibilities for the position of $S$ exist:
\\

\indent $R$ lies between $P$ and $S$,\\
\indent or $P$ lies between $R$ and $S$,\\
\indent or $S$ lies between $P$ and $R$ simultaneously when $Q$ lies between $P$ and $S$,\\
\indent or $S$ lies between $P$ and $Q$,\\
\indent or $P$ lies between $Q$ and $S$.
\\

The first four possibilities satisfy the hypotheses of [the second lemma] and the last one satisfies those of [the first lemma]. Theorem~5 is thus proved.\end{minipage}}
\caption{Case-Analysis for Theorem~5}
\label{fig:Theorem5Cases}
\end{figure}

For the purposes of verification, we probably want to tidy up Hilbert's case-analysis. If we take Hilbert's last three clauses to be a nested case-analysis, the last of which is contradictory and can be discarded, then we just have:
\begin{displaymath}
\begin{cases}
$R$ \text{ lies between } $P$ \text{ and } $S$,\\
$P$ \text{ lies between } $R$ \text{ and } $S$,\\
$S$ \text{ lies between } $P$ \text{ and } $R$,
\begin{cases}
  $Q$ \text{ lies between } $P$ \text{ and } $S$,\\
  $S$ \text{ lies between } $P$ \text{ and } $Q$
\end{cases}
\end{cases}
\end{displaymath}

Hilbert says the case-analysis arises from applications of \ref{eq:four}, which tells us that of three points, one lies between the other two. When we generalise from four points to $n+1$ points, we apply induction, and two of the applications of \ref{eq:four} become applications of our inductive hypothesis to $n$ points.

\begin{proof}
Now let $n+1$ points on a line be given. Take $n$ of the points and label $P$, $Q_1$, $Q_2$, $\ldots$, $Q_{n-2}$, $R$ the ones which by our inductive hypothesis are ordered along the line. Finally, label $S$ the last of the $n+1$ points. By Axiom~\ref{eq:g23} and \ref{eq:four} it follows then that the following three distinct possibilities for the position of $S$ exist:

\vspace{0.5cm}
\noident $R$ lies between $P$ and $S$,\\
\noident or $P$ lies between $R$ and $S$,\\
\noident or $S$ lies between $P$ and $R$.
\vspace{0.5cm}

In the last case, we apply our inductive hypothesis to the points $P$, $Q_1$, $Q_2$, $\ldots$, $Q_{n-2}$, $S$. In any of these cases, we can apply Theorem~\ref{eq:OrderExtend} to label all the points in order.
\begin{align}
  \label{eq:BoundsDef}
  &\code{bounds}\ P\ Q\ X \iff P,Q \in X \wedge \forall R. R \in X - \{P,Q\} \implies \between{P}{R}{Q}\\
  \label{eq:OrderExtend}
  &\code{finite}\ X \wedge \code{ordering}\ f\ X \wedge \between{(f 0)}{(f (|X| - 1))}{x}\notag\\
  &\qquad \implies \exists g. \code{ordering}\ g\ (\{x\} \cup X)\\
  \label{eq:ChooseOrder}
  &x \in X \wedge \code{finite}\ X \wedge \code{ordering}\ f\ X \wedge \code{bounds}\ P\ Q\ X\notag\\
  &\qquad\implies\exists f'. \code{ordering}\ f'\ X \wedge f'\,0 = P \wedge f'\,(|X| - 1) = Q.
\end{align}

\end{proof}
We have replaced Hilbert's reference to his earlier parts of \ref{eq:five} with a reference to its generalisation in Theorem~\ref{eq:OrderExtend}. We actually need a few other theorems. Consider that after our final application of the inductive hypothesis, we will have two orderings $f$ and $g$. The ordering $f$ applies to the points $P,$ $Q_1$, $Q_2$, $\ldots$, $Q_{n-2},$ $R$, and the ordering $g$ applies to the points $P$, $Q_1$, $Q_2$, $\ldots$, $Q_{n-2}$, $S$. But  there is some notational abuse here, as we gloss over an implicit assumption that $f(0) = g(0) = P$. In our verification, we can make this reasoning explicit with Theorem~\ref{eq:ChooseOrder}, which uses the auxiliary concept of \code{bounds}. 

Our generalised proof handles its case-analyses by one application of Theorem~4, and two applications of an induction hypothesis. This means we must apply well-founded induction rather than normal structural induction, since we must instantiate our inductive hypothesis in two different ways. 

The base case of the induction is captured in two lemmas:
\begin{displaymath}
  \begin{aligned}
    &\exists f. \code{ordering}\ f\ \emptyset\\
    &\code{collinear} \{x,y,z\} \implies \exists f. \code{ordering}\ f\ \{x,y,z\}.
  \end{aligned}
\end{displaymath}

The case for the empty set is trivial: literally any function witnesses the existential, since the conditions on the function are all vacuous. The second case actually breaks down into four separate cases, depending on whether any of the $x$, $y$ or $z$ are equal. For a single point, we can pick the constant function to that point, and for two points $x \neq y$, we pick the function which maps $0$ to $x$ and everything else to $y$.

For three points $\between{P}{Q}{R}$, we have the ordering which maps $0$ to $P$, $1$ to $Q$ and all other numbers to $R$. Since Theorem~4 requires that, of any three collinear points, one lies between the other two, it follows that there must be an ordering for any three collinear points. This takes care of the base case. And thus, we formally verify:
\begin{equation}
  \label{eq:six}
  \tag{Theorem~6}
  \begin{split}
    \code{finite}\ X \wedge \code{collinear}\ X \implies \exists f. \code{ordering}\ f\ X.
  \end{split}
\end{equation}

\subsection{Exactly Two Orderings}
Hilbert closes his statement of Theorem~6 with an obvious point which we found to have a slightly challenging formal proof and verification: ``Besides this order of labelling there is only the reverse one that has the same property.''.

To verify this, we began with a lemma: if we have two orders $f$ and $g$ where\linebreak $f(0)~=~g(0)$, then the orders are identical. 
\begin{multline}
  \code{ordering}\ f\ X \wedge \code{ordering}\ g\ X \wedge f\ 0 = g\ 0
  \wedge (\code{finite}\ x \implies n < |X|) \implies f\ n = g\ n.
\end{multline}

The verification of this theorem uses induction. Aiming for a contradiction, we assume that $f\ (n+1) \neq g\ (n+1)$ and then consider the relative positions of $f\ 0$, $f\ (n+1)$ and $g\ (n+1)$ that arise from \ref{eq:four}. For each possibility, we can apply \ref{eq:five} to show that there will end up being a point between $f\ n$ and $f\ (n+1)$, or a point between $g\ n$ and $g\ (n+1)$. But the existence of such a point contradicts the verified fact that orderings are injections:
\begin{multline}
  \code{ordering}\ f\ X \wedge (\code{finite}\ X \implies m < |X| \wedge n < |X|) \wedge f\ m = f\ n \implies m=n.
\end{multline}

Putting these facts together, we can verify Hilbert's assertion.
\begin{multline}
%`!f g X. FINITE X /\ ORDERING f X /\ ORDERING g X ==>
%               (!n. (FINITE X ==> n < CARD X) ==> f n = g n)
%               \/ !n. (FINITE X ==> n < CARD X) ==> f n = g (CARD X - n - 1)`
  \code{finite}\ X \wedge \code{ordering}\ f\ X \wedge \code{ordering}\ g\ X \wedge (\code{finite}\ X \implies n < |X|)\\
  \implies \forall n. f\ n = g\ n \vee f\ n = g (|X| - n - 1)
\end{multline}

\section{An Ordering Tactic}
\ref{eq:six} says everything one wants to know about the order of a finite number of points on a line, but it is not immediately obvious how to apply it.

One thing we can do with \ref{eq:six} is use it to convert problems involving betweenness into problems of linear arithmetic. To handle this, we will need to consider what is basically the inverse of the \code{ordering} function, given as $f$ in the following theorem:
\begin{equation}
\label{eq:OrderInverse}
\begin{split}
  &\code{finite}\ x \wedge \code{collinear}\ X\\
  &\implies \exists f. \forall A\ B\ C.\ A \in X \wedge B \in X \wedge C \in X \\
  &\qquad\qquad\implies (\between{A}{B}{C} \\
  &\qquad\qquad\qquad\qquad\iff (f\ A < f\ B \wedge f\ B < f\ C) \vee (f\ C < f\ B \wedge f\ B < f\ A))\\
  &\quad\wedge \forall A\ B.\ A \in X \wedge B \in X \implies (A = B \iff f\ A = f\ B)
\end{split}
\end{equation}

On the assumption that one has a collinear and finite set of points $X$, this theorem allows us to obtain a function $f$ with which we can take goals in terms of betweenness and equalities of points, and rewrite them into inequalities and equations of natural numbers. Once rewritten, the goal can be solved by HOL~Light's decision procedure for linear arithmetic. The procedure is not particularly efficient, but in practice, we have only considered simple betweenness problems (at most, ones involving six points).

When discharging the assumption in Theorem~\ref{eq:OrderInverse}, we expect the user to have instantiated $X$ with a concrete set enumeration (an expression of the form $\{P_1,P_2,\ldots,P_n\}$). These sets can be proven finite by simple rewriting. To prove them collinear, we reuse our incidence discoverer from Chapter~\ref{chapter:Automation}.

We package this up as the procedural tactic \code{ORDER\_TAC}, which is parameterised on a concrete set enumeration. It solves its goal by instantiating $X$ in Theorem~\ref{eq:OrderInverse}, running an incidence discoverer as a tactic via \code{discover\_tac} (see \S\ref{sec:DiscoverTac}), and finally discharging the assumption in Theorem~\ref{eq:OrderInverse} by rewriting. It then hands over to HOL~Light's decision procedure for linear arithmetic, \code{ARITH\_TAC}.

\subsection{Example: Theorem~7}
To round up this chapter, we will apply our linear reasoning tactic \code{order\_tac} to a theorem which says that there is an infinite set between any two points. 

In a sense, this has been covered indirectly by Theorem~\ref{eq:Infinity}, but our purpose with that theorem was to settle foundational questions about our logical assumptions, and provide us with enough expressive power to formally verify Theorem~6. Here, we can be more direct in our formalisation.
\begin{quotation}THEOREM~7. Between any two points on a line there exists an infinite number of points.
\end{quotation}
\begin{equation}
\label{eq:seven}
P\neq Q \implies \code{infinite}\ \{R\; \vert\; \between{P}{R}{Q}\}.
\end{equation}

We start our proof by assuming that the set of points between $P$ and $Q$ is finite. We then consider separately whether the set contains fewer than two elements, and whether it contains more than two elements. 

We describe the proof briefly. In the first case, we just use Theorem~3 twice to find two points between $P$ and $Q$, from which we can obtain a contradiction. In the second case, we get to apply \ref{eq:six}. The basic idea is as follows: we obtain an ordering $f$ of all points between $P$ and $Q$, and then take the first two elements of this ordering, namely $f\ 0$ and $f\ 1$. Via Theorem~3, we can find a point $R$ that lies strictly between them. According to our assumption, this point must be in the image of $f$. But this contradicts the definition of an ordering.

The part of our verification where we apply our linear ordering tactic might come as a surprise. It is actually used to verify a point glossed over in the informal argument, namely, that $R$ must be in the image of $f$. To show this, we must verify that $R$ lies between $P$ and $Q$.

Before we had implemented our tactic, we tried to verify this matter directly using \ref{eq:four} and \ref{eq:five}, but we gave up. The necessary case-analyses were just not intuitive to us. But \code{ORDER\_TAC} takes care of the matter elegantly.

\fbox{\begin{minipage}{\linewidth}\setlength\abovedisplayskip{0cm}
\small
\begin{align*}
  &\ldots\\
  &\code{so consider}\ R\ \code{such that}\ \between{(f\ 0)}{R}{(f 1)} & 7\\
  &\code{have}\ \between{P}{(f\ 0)}{Q} \wedge \between{P}{(f\ 1)}{Q}
  \ \code{from}\ 6\ \code{by} \ldots & 8\\
  &\code{hence}\ \between{P}{R}{Q}\ \code{from}\ 6,7\ \code{using}\ \code{ORDER\_TAC}\ \{P,Q,R,f\ 0,f\ 1\}\\
\ldots
\end{align*}\end{minipage}}\linebreak

\section{Conclusion}
In this chapter, we tackled the verification of Hilbert's Theorem~6. This is a metatheorem, so its verification requires a logic with more expressive power than is available in first-order logic. 

We aim to be conservative, so while we assume the power of higher-order logic, we do not assume the axiom of infinity from which we normally acquire the natural numbers. Instead, we have shown that Hilbert's first two groups of axioms imply infinity as a theorem. On the way, we verified that the first group alone cannot do this, since it admits a finite model.

We described two ways that we can implement Theorem~6 as a tactic. We suggest this is more faithful to Hilbert's intentions, since the theorem is metatheoretical and computational, manipulating labellings according to a scheme.

Our first tactic requires settling on a way to represent stacked betweenness claims and then writing procedures to enumerate all possible stackings for a given finite list of points. Our second strategy was to use our formally verified Theorem~6 to convert betweenness problems into arithmetical problems. That way, we can reuse decision procedures for linear arithmetic.

The second tactic has the advantage that it automatically copes with problems with equations and inequalities. In our first tactic, we assume that all points are distinct when we enumerate the possible orderings,  and we found that this assumption is too strong in practice. That said, we expect that our first tactic has potentially better performance, since it is more carefully tailored to Hilbert's geometry. We leave analysis of this matter to future work.

This concludes the description of the automation we have implemented for our verification: in summary, we use a search algebra to handle the implicit incidence reasoning from Group~I, and a tactic to handle linear reasoning from Group~II. These two automated tools were used extensively in the rest of our verification, which will be discussed in the remaining chapters. 

%The step case in our recursive metalevel procedure used two recursive calls on two different sets of points. So if we intend to do the same for the inductive hypothesis, then our induction cannot be the default one for finite sets, which has the form

% \begin{displaymath}
% \vdash \forall P. P\,\emptyset \wedge (\forall x\, X. P\,X \implies P\,(\{x\} \cup X)) \implies \forall x. P\,X.
% \end{displaymath}

%Instead, we use natural number induction on the size of the set. We assume that we can order $n$ points, and must show how to order a set $X$ containing $n+1$ points. Because of our base case, we can assume that $n \geq 3$.

%Looking at the cases for Theorem~5 from Figure~\ref{fig:Theorem5Cases}, it is clear that Hilbert is considering three case-splits based on Theorem~4. First, he considers the position of three of the points, stating ``label $Q$ the one which by Theorem~4 and Axiom II,3 lies between the other two and label the other two $P$ and $R$''. If Hilbert is talking again about ``labellings'', then we should be talking about ``orderings''. And thus, this does not generalise to an application of Theorem~4, but an application of our inductive hypothesis to $n$ of the points of $X.$ Thus, our first step is to obtain an ordering $f$ of $n$ of the points.

%From his next two cases, it is clear that Hilbert next applies Theorem~4 to the points he has labelled $P$ and $R$, and to the remaining point $S$. Let us call \emph{our} remaining point $x$. Then we recognise that $P$ and $R$ are the bounds of the ordering of $P$, $Q$ and $R$, which in the general case are the bounds $f\,0$ and $f\,(n - 1)$.

%In our generalisation we apply Theorem~4 to the points $x$, $f\,0$ and $f\,(n - 1)$. Hilbert's first two cases, where $x$ does not lie between the bounds are easily dealt with. In fact, we can assume (by normalising with Axiom~II,1 and applying \eqref{eq:OrderRev}) that there is an ordering $g$ of $X - \{x\}$ such that $\between{(g\,0)}{(g\,(n - 1)}{x}$. From this, we obtain our result directly from \eqref{eq:OrderExtend}.

%As with Hilbert's cases, when $x$ lies between the bounds, we have another case-split. Hilbert applies Theorem~4 once again, this time to the points $P$, $Q$ and $S$. In our generalisation, $P$ is $f\,0$ and $S$ is $x$. What is $Q$ however? In our generalisation, it must be \emph{all} the points between $P$ and $f(n - 1)$. So once again, this is \emph{not} an application of Theorem~4, but an application of the inductive hypothesis. That is, we are going to order the points $f\,0,f\,1,\ldots,f\,(n - 2),x$ to give us another ordering $g$.

%Using the lemmas from Figure~\ref{fig:OrderLemmas}, we can choose this ordering such that $f\,0 = g\,0$. As with Hilbert, there is another case-split to consider. Hilbert asks whether $Q$ lies between $P$ and $S$. This would make the point $S$ a bound in the ordering of $P$, $Q$ and $S$, which nicely generalises to the case $g(n - 1) = x$. We can deal with this by an immediate application of \eqref{eq:OrderExtend}.

%This brings us to Hilbert's penultimate case where $S$ lies between $P$ and $Q$. In other words, $S$ lies between the bounds of $P$ and $Q$. We generalise by noting that $f$ orders all points bar $x$. So $g(n - 1)$ must lie between $f 0$ and $f(n-1)$. Hence, a final application of \eqref{eq:OrderExtend} gives us our desired conclusion.

%Thus, we have formally generalised Hilbert's proof of Theorem~5, and seen how two of his applications of Theorem~4 are in fact uses of an induction hypothesis. Furthermore, we have shown that the final step in each case is an application of \eqref{eq:OrderExtend}.
%%% Local Variables: 
%%% TeX-master: "../thesis"
%%% End: 
